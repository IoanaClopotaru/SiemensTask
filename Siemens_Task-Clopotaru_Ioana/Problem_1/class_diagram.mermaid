classDiagram
    class Customer {
      -int customerId
      -String name
      -String email
      -String phone
      +getLoyaltyPoints() int
      +earnPoints(amountSpent: decimal) void
      +canRedeem(requiredPoints: int) bool
      +redeemPoints(points: int) void
      +getPointsPerEuro() int
    }
    note for Customer "getLoyaltyPoints() = sum(EARNED) - sum(REDEEMED) from LoyaltyTransaction"
    <<abstract>> Customer

    class RegularCustomer {
      +getPointsPerEuro() int
    }

    class GoldCustomer {
      +getPointsPerEuro() int
    }

    class PointTransactionType {
    }
    <<enumeration>> PointTransactionType
    PointTransactionType : EARNED
    PointTransactionType : REDEEMED

    class LoyaltyTransaction {
      -int transactionId
      -Customer customer
      -Order order
      -PointTransactionType type
      -int points
      -DateTime timestamp
    }

    class CoffeeShop {
      -int shopId
      -String name
      -String address
      +getDailySales(date: DateTime) decimal
      +getOrders(date: DateTime) List~Order~
    }

    class Barista {
      -int baristaId
      -String name
      +prepareOrder(order: Order) void
      +markOrderCompleted(order: Order) void
    }

    class Order {
      -int orderId
      -Customer customer
      -CoffeeShop coffeeShop
      -Barista barista
      -DateTime timestamp
      -decimal subtotal
      -decimal discountAmount
      -decimal finalTotal
      -OrderStatus status
      -List~OrderItem~ items
      +addItem(item: OrderItem) void
      +calculateTotal() decimal
      +redeemForFreeDrink(freeItem: OrderItem) void
      +finalize() void
    }

    class OrderStatus {
    }
    <<enumeration>> OrderStatus
    OrderStatus : PENDING
    OrderStatus : IN_PREPARATION
    OrderStatus : COMPLETED
    OrderStatus : CANCELLED

    class OrderItem {
      -int orderItemId
      -Beverage beverage
      -Size size
      -int quantity
      -decimal unitPrice
      -decimal lineTotal
      +addExtra(extra: Extra, quantity: int) void
      +calculateLineTotal() decimal
    }

    class OrderItemExtra {
      -int orderItemExtraId
      -OrderItem orderItem
      -Extra extra
      -int quantity
      -decimal unitPrice
      -decimal lineTotal
    }
    note for OrderItemExtra "unitPrice/lineTotal = snapshot at order time"

    class Size {
    }
    <<enumeration>> Size
    Size : SMALL
    Size : MEDIUM
    Size : LARGE

    class BeverageName {
    }
    <<enumeration>> BeverageName
    BeverageName : ESPRESSO
    BeverageName : LATTE
    BeverageName : CAPPUCCINO

    class Beverage {
      -int beverageId
      -BeverageName beverageName
      +getBasePrice(size: Size) decimal
    }

    class BeveragePrice {
      -int beveragePriceId
      -Beverage beverage
      -Size size
      -decimal price
      +getPrice() decimal
    }

    class Extra {
      -int extraId
      -String name
      -decimal price
      +getPrice() decimal
    }

    Customer "1" --> "0..*" Order : places
    Customer "1" o-- "0..*" LoyaltyTransaction : has
    LoyaltyTransaction "*" --> "1" Order : for
    Order "1" o-- "0..*" LoyaltyTransaction : generates
    CoffeeShop "1" o-- "0..*" Barista : employs
    CoffeeShop "1" o-- "0..*" Order : receives
    Barista "1" --> "0..*" Order : prepares
    Order "1" o-- "1..*" OrderItem : contains
    OrderItem "1" --> "1" Beverage : for
    OrderItem "1" o-- "0..*" OrderItemExtra : has
    OrderItemExtra "0..*" --> "1" Extra : extra
    Beverage "1" o-- "1..*" BeveragePrice : has

    Customer <|-- RegularCustomer
    Customer <|-- GoldCustomer
